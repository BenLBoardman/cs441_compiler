data:
global array vtblListNode: { getValListNode, getNextListNode, 0, 0 }
global array vtblStack: { 0, 0, popStack, pushStack }
code:

getValListNode(%this):
	%0 = %this + 8
	%1 = load(%0)
	ret %1
getNextListNode(%this):
	%0 = %this + 16
	%1 = load(%0)
	ret %1

popStack(%this):
	%0 = %this + 8
	%1 = load(%0)
	%2 = %1 == 0
	if %2 then popStack1 else popStack2
popStack1:
	ret 0
popStack2:
	%3 = %this + 8
	%4 = load(%3)
	%5 = load(%4)
	%6 = getelt(%5, 0)
	%7 = call(%6, %4)
	%9 = load(%3)
	%10 = load(%9)
	%11 = getelt(%10, 1)
	%12 = call(%11, %9)
	store(%3, %12)
	ret %7
pushStack(%this, %v):
	%tmp0 = alloc(3)
	store(%tmp0, @vtblListNode)
	%0 = %tmp0 + 8
	store(%0, %v)
	%1 = %this + 8
	%2 = load(%1)
	%3 = %tmp0 + 16
	store(%3, %2)
	store(%1, %tmp0)
	ret 0

main:
	%stk0 = alloc(2)
	store(%stk0, @vtblStack)
	%0 = %stk0 + 8
	store(%0, 0)
	jump main1
main1:
	%cnt1 = phi(main, 10, main2, %6)
	%1 = %cnt1 > 0
	if %1 then main2 else main3
main2:
	%2 = load(%stk0)
	%3 = getelt(%2, 3)
	%4 = call(%3, %stk0, %cnt1)
	%6 = %cnt1 - 1
	print(%6)
	jump main1
main3:
	jump main4
main4:
	%cnt2 = phi(main3, %cnt1, main5, %11)
	%7 = %6 < 10
	if %7 then main5 else main6
main5:
	%8 = load(%stk0)
	%9 = getelt(%8, 2)
	%10 = call(%9, %stk0)
	print(%10)
	%11 = %6 + 1
	jump main4
main6:
	ret 0